{% extends "layout.html" %}
{% block body %}
<div class="listContainer">
    <!-- <a href="https://itunes.apple.com/us/app/density-columbia-study-spaces/id1065376976">
        <img class="app_store" src="{{ url_for('static', filename='img/app_store_badge.svg')}}">
    </a> -->

    <div class="container">
        <div class="searchContainer">
            <input type="text" class="searchTerm" id="search" onkeyup="searchLocations()" autocomplete= "off">
            <button type="submit" class="searchButton">
                <i class="fa fa-search"></i>
            </button>
        </div>
    </div>

    <div class="container">
        <div class = "btnContainer">
          <div id="locationBtnContainer" align="left">
              <input type="radio"  name="location-filter" id="library" value="library" onclick = "searchLocations()"/> <label for="library"> Library </label>
              <input type="radio"  name="location-filter" id="center" value="center" onclick = "searchLocations()"/> <label for="center"> Student Center </label>
              <input type="radio"  name="location-filter" id="dining" value="dining" onclick = "searchLocations()"/> <label for="dining"> Dining Hall </label>
              <button class="clear" onclick="clearFilter('location-filter')">(x)</button>
          </div>

          <div id="openBtnContainer" align="right">
              <input type="radio" class="filterTab" name="open-filter" id="open" value="True" onclick = "searchLocations()"/> <label for="open"> Open Now </label>
              <input type="radio" class="filterTab" name="open-filter" id="closed" value="False" onclick = "searchLocations()"/> <label for="closed">Closed </label>
              <button class="clear" onclick="clearFilter('open-filter')">(x)</button>
          </div>
        </div>
    </div>


    <div class="container">
        <ul class="list-group">
            {% for location in locations %}
              <li class="list-group-item" data-name="{{ location['group_name'] }}" 
                                          data-nickname="{{ auxdata[location['group_name']]['nickname'] }}"
                                          data-location-type="{{ auxdata[location['group_name']]['type'] }}"
                                          data-open-now="{{ auxdata[location['group_name']]['open'] }}">
                <h4>{{ location['group_name'] }}<span class="opening-time">{{times[location['group_name']]}}</span></h4>
                  <div class="progress">
                      {% if location['percent_full'] <= 2 %}
                          <div class="progress-bar progress-bar-info progress-bar-striped active"
                             role="progressbar" aria-valuenow="0"
                             aria-valuemin="0" aria-valuemax="100"
                             style="width: 0;">
                             {{ location['percent_full'] }}%
                          </div>
                      {% else %}
                          <div class="progress-bar progress-bar-info progress-bar-striped active"
                             role="progressbar" aria-valuenow="{{location['percent_full']}}"
                             aria-valuemin="0" aria-valuemax="100"
                             style="width: {{location['percent_full']}}%;">
                             {{ location['percent_full'] }}%
                          </div>
                      {% endif %}
                  </div>
              </li>
            {% endfor %}
        </ul>
    </div>
    <div class="update">Last updated {{ last_updated }}</div>
    <div class="update"> 
        <span class="opening-time">
        * Library opening and closing times may vary during Finals week and University Holidays
        </span>
    </div>
</div>
<div class="thanksContainer">
    <div class="container">
        <h4>Special thanks to <img class="logo escLogo" src="{{ url_for('static', filename='img/esc.png')}}">
        </h4>
    </div>
</div>
<script type="text/javascript">
  function searchLocations() {
    var li = document.getElementsByTagName('li');
    var searchQuery = document.getElementById('search').value.toLowerCase();
    var locationFilter = '';
    var openFilter = '';

    var locationBtns = document.getElementsByName('location-filter');
  
    for(var i = 0; i < locationBtns.length; i++){
      if(locationBtns[i].checked){
        locationFilter = locationBtns[i].value;
       }
     }

    var openBtns = document.getElementsByName('open-filter');
  
    for(var i = 0; i < openBtns.length; i++){
      if(openBtns[i].checked){
        openFilter = openBtns[i].value;
       }
     }


    for (i = 0; i < li.length; i++) {
      var name = li[i].getAttribute('data-name').toLowerCase();
      var nickname = li[i].getAttribute('data-nickname').toLowerCase();
      var locationType = li[i].getAttribute('data-location-type');
      var openNow = li[i].getAttribute('data-open-now');

      if ((!name.includes(searchQuery) && !nickname.includes(searchQuery)) ||
          (locationFilter != '' && locationFilter != locationType) ||
          (openFilter != '' && openFilter != openNow)) {
        li[i].style.display = 'none';
      }
      else {
        li[i].style.display = 'block';
      }
    }
  }
  
  function clearFilter(name) {
    var ele = document.getElementsByName(name);
    for(var i=0; i<ele.length; i++)
      ele[i].checked = false;
    searchLocations();
  }
</script>

{% endblock %}
{% block scripts %}
    <script src="{{ url_for('static', filename='js/capacity.js') }}"></script>
{% endblock %}
